<!--
* RCE Coach software is available through a GLPv3 open-source software license.
* Any attribution should include the following:
*   © 2016, Mathematica Policy Research, Inc. The RCE Coach software was developed by
*   Mathematica Policy Research, Inc. as part of the Rapid Cycle Tech Evaluations project funded
*   by the U.S. Department of Education’s Office of Educational Technology through
*   Contract No. ED-OOS-15-C-0053.
-->
<!-- views/partials/tool.html -->

<div class="row">
    <div class="step-row">
        <div class="col-xs-12">
            <h1><%= coachStep.name %></h1>
            <p><%= coachStep.intro %></p>
        </div>
    </div>
</div>
<div class="row">
    <div class="tool-row">
        <% for (var i=0; i< tools.length; i++) {
        var divid = "ToolDiv-"+tools[i].step;
        var statusdivid = "StatusDiv" + tools[i].step;
        var tool =[], status = "NOT STARTED", d = "", btnText = "START";
        var peeking=false, firstTool =false;
        var lock = "";
        if (eval.flag == 1) { peeking =true; }
        if (tools[i].name==="The Basics") firstTool=true;
        if (eval.toolsvisited) {tool = eval.toolsvisited.filter(function (x) { return x.name === tools[i].name });

        if (tool.length > 0) {

        status = tool[0].status;
        d=new Date(tool[0].visited_at)
        if (status.toLowerCase()=="completed") {btnText="EDIT"} else {btnText="CONTINUE"}
        }
        }       //tool visited

        var current = eval.last_tool == tools[i].name ? "current" : "";
        var buttondivid = tools[i].name;
        if (peeking && !firstTool || (tools[i].coachStep===5 &&  tools[i].evalPath !== eval.path)) {btnText="PEEKING"; lock="locked"}
        <!--if (tools[i].coachStep===5 &&  tools[i].evalPath !== eval.path ){peeking=true; lock="locked";}-->
        %>
        <div class="col-xs-3">

            <div id="<%= divid %>" class="tool-div <%= status %> <%= current %>">
                <div class="tool-title">
                    <%
                    if (status.toLowerCase()=="completed" && tools[i].type.toLowerCase() == "guide") { status = "Viewed";}
                    %>
                    <h2 class="<%= tools[i].type %> <%= lock %>"><%= tools[i].name %> </h2>
                    <p><%= tools[i].desc %></p>
                </div>
                <div class="tool-bottom">
                    <div id="<%= statusdivid %>" class="tool-status status">
                        <% if (tool.length > 0) { %>
                        <p>
                            Status<br /><span class="all-caps" id="status"><strong><%= status %></strong></span><br />
                            Last Visit<br /><strong><span id="visitedat"><%= d.getMonth() + 1 + '/' + d.getDate() + '/' + d.getFullYear() %></span></strong>
                        </p>

                        <% } %>

                        <%  if (lock==="locked") {%>
                        <p>
                            Status<br /><span class="all-caps" id="status"><strong>UNAVAILABLE</strong></span><br />
                        </p>
                        <% } %>


                    </div>
                    <div class="tool-view-btn">

                        <% var option=""; if (tools[i].path) {option=tools[i].path; if (lock==="locked") option=tools[i].path + "?peeking=1"} %>
                        <% if (option.indexOf(".pdf") !== -1) { %>
                        <!--<button type="button" id="viewpdf" class="btn btn-primary btn-lg" >VIEW</button>-->
                        <a id="viewpdf" class="tool-view-button btn btn-primary btn-lg" href="#">VIEW <span class="fa fa-download" aria-hidden="true"></span></a>
                        <% } else { %>
                        <a href="<%= option %>" class="tool-view-button btn btn-primary btn-lg"><%= btnText %></a>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
        <div>
            <input class="hidden" id="toolname" value="<%= tools[i].name  %>" />
            <input class="hidden" id="toolpath" value="<%= tools[i].path  %>" />
            <input class="hidden" id="toolstep" value="<%= tools[i].step  %>" />
            <input class="hidden" id="wizardpath" value="<%= tools[i].wizardPath  %>" />
        </div>
        <% } %>

        <div style="clear: both; line-height: 0">&nbsp;</div>


    </div>
</div>
<script>
    $("#viewpdf").click(function (e) {

        var name = $("#toolname").val();
        var step = $("#wizardpath").val();
        var path = $("#toolpath").val();
        var currentStatus = $("#status").text();


        $.ajax({
            type: "POST",
            url: "../pdf_view",
            data: JSON.stringify({
                "tname": name,
                "step": step
            }),

            dataType: "json",
            contentType: "application/json",
            success: function(eval, status, xhr) {

                if (eval.toolsvisited) {
                    tool = eval.toolsvisited.filter(function(x) { return x.name === $("#toolname").val() });
                    if (tool.length > 0) {

                        status = tool[0].status;
                        var usestatus = "";
                        if (status.toLowerCase() === "completed") {
                            usestatus = "Viewed";
                        }
                        d = new Date(tool[0].visited_at);
                        var NewStatus = '<p> Status<br /><span class="all-caps"><strong>' + usestatus + '</strong></span><br />Last Visit<br /><strong><span>' + d.getMonth() + 1 + '/' + d.getDate() + '/' + d.getFullYear() + '</span></strong></p>';
                        $("#ToolDiv-" + $("#toolstep").val()).addClass(status);
                        $("#ToolDiv-" + $("#toolstep").val()).addClass("current");
                        $("#StatusDiv" + $("#toolstep").val()).html(NewStatus);
                        setWizardNav($("#wizardpath").val(), $("#wizardpath").val());
                    }
                }


            }
        });


        window.open($("#toolpath").val(), "_blank", "fullscreen=yes");
    });

</script>








