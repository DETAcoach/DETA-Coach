<!--
* RCE Coach software is available through a GLPv3 open-source software license.
* Any attribution should include the following:
*   © 2016, Mathematica Policy Research, Inc. The RCE Coach software was developed by
*   Mathematica Policy Research, Inc. as part of the Rapid Cycle Tech Evaluations project funded
*   by the U.S. Department of Education’s Office of Educational Technology through
*   Contract No. ED-OOS-15-C-0053.
-->
<!-- views/profile.ejs -->
<!doctype html>
<html>
<head>
    <title>Dashboard - Ed Tech RCE Coach</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.feedback_me.js"></script>
    <script src='/static/js/custom.js'></script>
    <link type="text/css" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700italic,400italic,700italic,300,400,700);" />
    <link rel="stylesheet" href="/static/css/main.css" />
    <link rel="stylesheet" href="/static/css/font-awesome.min.css" />
    <link rel="stylesheet" href="/static/css/jquery.feedback_me.css" />
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-86460597-1', 'auto');
        ga('send', 'pageview');

    </script>
</head>
<body class="dashboard">
    <% include ../views/partials/header.html %>
    <div class="container-fluid">
        <input type="hidden" id="user_name" value="<%= user.profile.user_name %>" />
        <input type="hidden" id="user_email" value="<%= user.email %>" />
        <div class="page-header">
            <h1 class="page-title">Evaluation Dashboard</h1>
        </div>
        <div class="row">
            <div class="col-sm-3">
                <div class="dash-well">
                    <h2 class="text-center">
                        <%= user.profile.user_name %>
                    </h2>
                    <% var role = user.profile.role; if (role == "other") (role =user.profile.role_other ) %>
                    <p class="text-center"><%= role %></p>
                    <p class="text-center">
                        <span class="fa fa-user fa-5x" style="color: #dddddd;"></span>
                    </p>
                    <p class="text-center">
                        <%= user.profile.organization_name %>
                    </p>
                </div>
                <div class="dash-well sidebar-left">
                    <div class="row">
                        <ul class="wizard-menu">
                            <li class="wizard-item">
                               <button type="button" class="btn-link sec-label" role="link" data-toggle="modal" data-target="#myModal">START A NEW EVALUATION </button></li>

                            <li class="wizard-item">

                                <button role="link" id="btnPublishedList" class="btn-link sec-label" onclick="">View Published Evaluations </button></li>

                        </ul>
                       
                    </div>
                </div>
            </div>
            <div class="col-sm-9">
                <%
                var evallabel = "Begin Evaluation"
                var evaltitle = "Ready to test an app?";
                var status= "New";
                var startdate = new Date();
                var statuslength = 0;
                var helpcaret = "fa-caret-down";
                var helphidden = "aria-hidden='false'"
                var helpdetail = "in"
                var eval = evals.filter(function (x) { return x._id.equals(user.evalid)});
                console.log(eval);
                if (eval.length>0) {
                var EvalButtonText = eval[0].status == 100 ? "Edit" : "Continue";
                evaltitle = eval[0].title;
                status=parseInt(eval[0].status) + "% Completed";
                statuslength = eval[0].status > 0 ? (200*(eval[0].status/100)) : 0;
                var statusstyle = eval[0].status == 100 ? "completed" : "";
                evallabel = "Current Evaluation";
                helpcaret = "fa-caret-right";
                helphidden = "aria-hidden='true'"
                helpdetail = ""
                if (eval[0].created_at)
                {
                startdate = eval[0].created_at 
                }
                }
                %>
                <div class="panel panel-default dash-well">
                    <div class="panel-heading">
                        <h2 class="panel-title  clickable">
                            <a data-toggle="collapse" data-target="#welcomeDetails">
                                <i class="fa <%= helpcaret %>" <%= helphidden %> ></i> Welcome
                            </a>
                        </h2>
                    </div>
                    <div id="welcomeDetails" class="panel-collapse collapse <%= helpdetail %>">
                        <div class="help-panel help-main">
                            <h3 class="sec-label">What does it take to conduct a rapid cycle evaluation? </h3>
                            <p>Read the basics on using the Ed Tech Rapid Cycle Evaluation Coach to conduct your own RCE. This overview shows the steps that you’ll need to complete and the tools that will help you through the process. </p>
                            <p class="pull-right">
                                <a onclick=" window.open('/static/pdf/RCTE One-Page Overview.pdf', ''); return false; " href="javascript:void(0);" style="font-size: 1.1em;">View <span class="fa fa-download" aria-hidden="true"></span></a>
                            </p>
                            <div class="clearfix"></div>
                        </div>
                        <div class="col-sm-6 help-panel help-sec">
                            <h3 class="sec-label">Choosing a technology</h3>
                            <p>If you are looking for a technology to implement, use this guide to help you with that process and return to the Coach once you are ready to plan a pilot of that technology. </p>
                            <p class="pull-right">
                                <a onclick=" window.open('/static/pdf/01.02ChooseATechnology.pdf', ''); return false; " href="javascript:void(0);" style="font-size: 1.1em;">View <span class="fa fa-download" aria-hidden="true"></span></a>
                            </p>
                        </div>
                        <div class="col-sm-6 help-panel ">
                            <h3 class="sec-label">Understanding types of evidence</h3>
                            <p>This resource describes common types and sources of evidence. It explains how to tell if the evidence can support claims that a technology is effective.</p>
                            <p class="pull-right">
                                <a onclick=" window.open('/static/pdf/01.03 UnderstandTypesofEvidence.pdf', ''); return false; " href="javascript:void(0);" style="font-size: 1.1em;">View <span class="fa fa-download" aria-hidden="true"></span></a>
                            </p>
                        </div>
                        <div class="clearfix"></div>

                    </div>
                    <div class="clearfix"></div>
                </div>
                <h2>Your Evaluations</h2>
                <div class="dash-well eval-div current <%= statusstyle %>">
                    <div style="float: left; width: 75%;">

                        <h3><%= evaltitle %></h3>
                        <div class="sec-label current"><%= evallabel %></div>
                        <% if (eval.length>0) { %>
                        <div class="indentleft10">
                            <p>
                                <span class="sec-label">Started</span>: <%= startdate.getMonth() + 1 + '/' + startdate.getDate() + '/' + startdate.getFullYear() %>
                            </p>



                            <span class="sec-label">Status</span>:
                            <div class="outer-status-bar">
                                <div class="status-bar" style="width: <%=statuslength + 'px'%>;">&nbsp;</div>
                            </div> <%= status %>
                        </div>
                        <% } %>
                        <% if (eval.length===0) { %>
                        <p>
                            Let the Ed Tech RCE Coach guide you through each step of evaluating your educational technology.
                        </p>
                        <% } %>
                        </div>
                    
                    <div style="float: right; width: 20%;">
                            <% if (eval.length>0) { %>  
                                <a class="text-right btn btn-primary" href="/coach" id="startEval" class="btn btn-primary btn-lg"><%= EvalButtonText %></a> <br />
                            <% } else if (eval.length===0) { %>
                            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">START EVALUATION</button>
                            <% } %>
                        </div>
                      
                       <div class="clearfix"></div>
                       
                        <!-- Trigger the modal with a button -->
                        <!-- Modal -->
                        <div id="myModal" class="modal fade" role="dialog">
                            <div class="modal-dialog">
                                <!-- Modal content-->
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                                        <h4 class="modal-title">Enter a name for your evaluation</h4>
                                    </div>
                                    <div class="modal-body">
                                        <% var evalid; if (eval) {evalid = eval._id} %>
                                        <input type="hidden" id="evalid" value="<%= evalid %>" />
                                        <input type="text" id="title" />
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-info btn-lg" data-dismiss="modal">CANCEL</button>
                                        <button type="button" id="getTitle" class="btn btn-primary btn-lg" data-dismiss="modal">OK</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                <%  if(evals.length>0){ for (var i=0; i < evals.length; i++){
                if (evals[i]._id.equals(user.evalid) ){continue;}
          
                var evaltitle = evals[i].title;
                var status=parseInt(evals[i].status) + "% Completed";
                var statuslength = evals[i].status > 0 ? (200*(evals[i].status/100))  : 0;
                var statusstyle = evals[i].status == 100 ? "completed" : "";
                var EvalButtonText = evals[i].status == 100 ? "Edit" : "Continue";
                var d = new Date(evals[i].created_at)
                var helpcaret = "fa-caret-down";
                var helphidden = "false"
                var helpdetail = "in" %>
                <div class="dash-well eval-div <%= statusstyle %>">
                    <div style="float: left; width: 75%;">
                        <h3><%= evaltitle %></h3>
                        <p>
                            <span class="sec-label evaldate">Started</span>: <%= d.getMonth() + 1 + '/' + d.getDate() + '/' + d.getFullYear() %>
                        </p>
                   
                            <span class="sec-label">Status</span>: <div class="outer-status-bar"><div class="status-bar" style="width: <%= statuslength + 'px' %>;">&nbsp;</div></div> <%= status %>
                        

                      
                    </div>
                   
                        <div style="float: right; width: 20%;">
                           
                                <a class="text-right btn btn-primary" href="/coach/<%= evals[i]._id %>" id="startEval"><%= EvalButtonText %></a>
                        
                        </div>

                   
                    <div class="clearfix"></div>
                    </div>
                <%}} %>
            </div>
        </div>
    </div>
    <% include ../views/partials/footer.html %>
    <script type="text/javascript">
        $(document).ready(function () {
            //init feedback_me plugin
            var fm_options = setFeedbackOptions($("#user_email").val(), "dashboard");
            fm.init(fm_options);

          
        });

        $("#getTitle").click(function (e) {
            var etitle = $("#title").val();
            var url = '/api/eval';
            $.ajax({
                type: "POST",
                url: url,
                data: JSON.stringify({ "title": etitle }),
                dataType: "json",
                contentType: "application/json",
                success: function (data) {
                    window.location = "/coach";
                }
            }).done(function (msg) {
            });;
        });
        $("#btnPublishedList").click(function (e) {
            document.location.href = "/publications"
        });
    </script>
</body>
</html>
