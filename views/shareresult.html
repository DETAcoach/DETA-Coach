<!--
* RCE Coach software is available through a GLPv3 open-source software license.
* Any attribution should include the following:
*   © 2016, Mathematica Policy Research, Inc. The RCE Coach software was developed by
*   Mathematica Policy Research, Inc. as part of the Rapid Cycle Tech Evaluations project funded
*   by the U.S. Department of Education’s Office of Educational Technology through
*   Contract No. ED-OOS-15-C-0053.
-->

<html>
<head>
    <title>Share Your Results - Ed Tech RCE Coach</title>
    <link type="text/css" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,300,400,700);" />
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/main.css" />
    <link rel="stylesheet" href="/static/css/bootstrap-multiselect.css" />
    <link rel="stylesheet" href="/static/css/font-awesome.min.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="/static/css/jquery.feedback_me.css" />
    <script src="/static/js/jquery.feedback_me.js"></script>
    <!--<script src="/static/js/bootstrap-multiselect.js"></script>-->
    <!--<link href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css" rel="stylesheet" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/js/bootstrap-editable.min.js"></script>-->
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
                m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-86460597-1', 'auto');
        ga('send', 'pageview');
    </script>

    
</head>
<body>

    <div id="header"></div>
    <% if (user != "NOAUTHENTICATED") { %>
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/coach"><span class="fa fa-caret-left"></span> Back to Summarizing Your Findings</a></li>
        </ol>
        <% if (message.length>0) { %>
        <div class="alert alert-success"><%= message %></div>
        <% } %>
        <% include ../views/partials/toolHeader.html %>
    <% } %>

    <form action="/matching" method="post">
        
        <div id="brief-results">
            <style>
                /* Specific to share results */

                h2 {
                    color: #4f81bd;
                    padding-top: 15px;
                }

                h3 {
                    padding-top: 10px;
                    letter-spacing: normal; /* default for rest of site is 1px, but it gets distorted in pdf output */
                }

                li {
                    margin-bottom: 10px;
                    font-size: 16px;
                }

                p {
                    font-size: 16px;
                }

                .row {
                    padding-top: 15px;
                }

                img {
                    max-width: 100%;
                    padding-bottom: 20px;
                }

                .white-background-blue-border {
                    border: 3px #2e75b6 solid;
                    border-radius: 25px;
                    font-size: 16px;
                    line-height: 1.5em;
                    padding: 25px;
                    margin: 15px;
                    max-width: 85%;
                }

                .blue-background-white-text {
                    background-color: #2e75b6;
                    border: 3px #2e75b6 solid;
                    border-radius: 25px;
                    color: #fff;
                    font-size: 20px;
                    margin: 15px;
                    min-height: 150px;
                    padding: 20px;
                    text-align: center;
                }

                #table1 {
                    width: 100%;
                }

                #table1 td, #table1 th {
                    font-size: 20px;
                    text-align: center;
                }

                #table1 thead tr {
                    border-bottom: 1px #000 solid;
                }

                #table1 tfoot tr {
                    border-top: 1px #000 solid;
                }

                .circle {
                    width: 50px;
                    height: 50px;
                    margin-top: 10px;
                    -webkit-border-radius: 25px;
                    -moz-border-radius: 25px;
                    border-radius: 25px;
                    background-color: #4f81bd;
                    text-align: center;
                    vertical-align: middle;
                    line-height: 50px;
                }
                
                .editable {
                    /*text-decoration: underline;*/
                    /*
                    background-color: #ddd;
                    padding-left: 5px;
                    padding-right: 5px;
                    margin-left: 5px;
                    margin-right: 5px;*/
                }
                    
            </style>
            <div class="container-fluid" > 
                <div class="row" > 
                    <div class="col-xs-12" > 
  
                        <% 
                            var stripPercent = function(x) {
                                return parseInt(x.replace(/%/g, ''));
                            }

                            var capitalize = function(x) {
                                return x[0].toUpperCase() + x.substring(1);
                            }

                            var wordList = function(x) {
                                var out;

                                if (x.length === 1) {
                                    out = x;
                                }
                                else if (x.length === 2) {
                                    out = x[0] + ' and ' + x[1];
                                }
                                else {
                                    out = x.slice(0, x.length - 1).join(', ') + ', and ' + x.slice(-1);
                                }   
                        
                                return out;                                            
                            }

                            var unique = function(x) {
                                   
                                for (var i = 0; i < x.length; i++) {
                                    if (x.indexOf(x[i]) < i) {
                                        x.splice(i, 1);
                                        i--;
                                    }
                                }

                                return x;
                            }

                            var tech_name = eval.basics.Basics_Tech_Name;
                            var basic_outcome = eval.basics.Basics_Outcome;
                            var users = eval.basics.Basics_Users;

                            var outcome_direction = eval.planQuestion.Outcome_Direction;
                            var outcome_measure = eval.planQuestion.Outcome_Measure;

                            var analysis_results = JSON.parse(eval.getresult.Result);
                            var analysis_results_by_grade = analysis_results.results_by_grade;

                            var analysis_by_grade = Object.keys(analysis_results_by_grade).length > 1;

                            var pass_probability = stripPercent(eval.planNext.Pass_Probability);
                        
                            var n_overall = 0, n_treatment = 0;

                            var path = eval.path;

                            var baseline_by_grade, baseline_results_by_grade, baseline_vars;
                            
                            if (path === 'path-matching') {
                                var match_results = JSON.parse(eval.matching.Result);
                                baseline_by_grade = Object.keys(match_results.results_by_grade).length > 1;
                                baseline_results_by_grade = match_results.results_by_grade;

                                for (grade in match_results.results_by_grade) {
                                    var samples = match_results.results_by_grade[grade].samples;
                                    n_overall += samples.n_matched[0];
                                    n_treatment += samples.n_matched_treat[0];
                                }

                                baseline_vars = JSON.parse(eval.matching.s_match_vars);
                            }

                            var baseline_vars_wordlist = wordList(baseline_vars);
                            var n_comparison = n_overall - n_treatment;                            
                            
                        %>
                        
                        <img src="/static/image/brief_header.png" / > 
                        <h1 class="tool-title" > [ReadTech] Findings Brief</h1 > 
                        <hr / > 
                        
                        <div class="row" > 
                            <div class="col-xs-1 circle" > 
                            </div > 
                            
                            <div class="col-xs-11" > 
                                <h2 > <%= tech_name + ' is' + '[needle_negate]' + ' moving the needle on ' + basic_outcome %></h2 > 
                            
                                <h3 > Research Question</h3 > 
                                    <span class="editable">Does</span> 
                                    <%= tech_name + ' ' + outcome_direction + ' ' + outcome_measure %>
                                    <span class="editable">among</span>
                                    <%= eval.planQuestion.Intervention_Group_Desc %>
                                    <span class="editable">compared to</span>
                                    <%= eval.planQuestion.Comparison_Group_Desc %>?
                                    
                                    <% for (grade in analysis_results_by_grade) { 
                                
                                        var probability = stripPercent(analysis_results_by_grade[grade].interpretation.probability[0]);
                                        var success = (probability > pass_probability);

                                        var needle_decision = (success) ? 'Yes' : 'No';
                                        var needle_negate = (success) ? '' : ' not';

                                        var next_steps = (success) ? eval.planNext.Action_Success : eval.planNext.Action_Fail;

                                        var interpretation_1 = analysis_results_by_grade[grade].interpretation.texts[1];
                                        var interpretation_2 = analysis_results_by_grade[grade].interpretation.texts[0];
                                    %>

                                        <% if (analysis_by_grade) { %>
                                            <h2>Grade <%= grade %></h2>
                                        <% } %>
                                        <h3> Findings</h3>
                                        <ol>
                                            <li> <%= needle_decision + ', we think ' + tech_name + ' is' + needle_negate + ' moving the needle.' %></li>
                                            <li> <%= interpretation_1 %></li>
                                            <li> <%= interpretation_2 %></li>
                                        </ol>
                                        <h3> Next steps</h3>
                                        <%= next_steps %>

                                    <% } %>
                            </div > 
                        </div > 
                        <div class="row" > 
                            <div class="col-xs-1 circle" > 
                            </div > 
                        
                            <div class="col-xs-11" > 
                                <h2 > This evaluation tested the effectiveness of <%= tech_name %></h2 > 
                                <%= tech_name + ' is [an individualized learning software that targets ' + users + '’ needs in both reading and mathematics].' %>
                            
                                <div class="white-background-blue-border" > 
                                    <strong > The Basics of <%= tech_name %></strong > <br / > 
                                    <em > Program Type</em > : [Supplement]<br / > 
                                    <em > Key Components</em > : [It is adaptive with on-grade-level instruction, practice, and diagnostics at a sub-skill level.]<br / > 
                                    <em > Delivery Type</em > : [Individual]<br / > 
                                    <em > Used in</em > : [1st, 2nd, 3rd, 4th and 5th Grade] [general classrooms]<br / > 
                                    <em > Target Outcomes</em > : [Comprehension, Reading Fluency, Reading Achievement]<br / > 
                                    <em > Cost</em > : [$10 per student] 
                                </div > 
                            </div > 
                        </div > 
                
                        <div class="row" > 
                            <div class="col-xs-1 circle" > 
                            </div > 
                        
                            <div class="col-xs-11" > 
                                <h2 > <%= tech_name %> was tested using a [randomized] pilot</h2 > 
                                <ul > 
                                    <li > This evaluation used a randomized pilot. The choice of who piloted the technology was determined by chance, like a coin flip. This design was the best way to determine if ReadTech was moving the needle because it allowed us to create two groups that were similar on both observed characteristics (such as prior achievement) and unobserved characteristics (such as motivation). This allows us to be confident that any differences seen in outcomes are due to the technology and not other factors.</li > 
                                    <li > [Groups of students were assigned based on classroom.]</li > 
                                    <li > Baseline equivalence (or similarity across treatment and comparison) was tested using: <span class="baseline_vars_wordlist">
                                        <%= baseline_vars_wordlist %></span> characteristics.</li > 
                                </ul > 
                                <% if (baseline_vars && baseline_vars.length > 0) { %>
                                    <h3>Re-label baseline variables (optional):</h3>
                                    <% for (index in baseline_vars) { 
                                            var baseline_var = baseline_vars[index]; %>
                                        
                                            <div class="row">
                                                <div class="col-xs-2">
                                                    Re-label <%= baseline_var %>:
                                                </div>
                                                <div class="col-xs-4">
                                                    <input type="text" class="relabel-baseline-var" value="<%= baseline_var %>" data-reset="<%= baseline_var %>"/>
                                                </div>
                                            </div>                                            
                                    <% } %>                                
                                    <div class="row">
                                        <div class="col-xs-4">
                                            <button class="btn btn-primary" id="relabel-baseline-vars">Re-label</button>
                                        </div>
                                    </div>
                                <% } %>
                            </div > 
                        </div > 
                    
                        <div class="row" > 
                            <div class="col-xs-1 circle" > 
                            </div > 
                        
                            <div class="col-xs-11" > 
                                <h2 > This evaluation studied <%= tech_name %>’s impact on [Elementary] <%= users %></h2 > 
                        
                                <div class="row" > 
                                    <div class="col-xs-3 blue-background-white-text" > 
                                        <p > <strong > Treatment Group</strong > </p >                                 
                                        <p > <%= capitalize(users) %> who used <%= tech_name %> </p >                                 
                                        <p > # of <%= users %>: <%= n_treatment %> </p > 
                                    </div > 
                            
                                    <div class="col-xs-3 blue-background-white-text" > 
                                        <p > <strong > Comparison Group</strong > </p > 
                                        <p > <%= capitalize(users) %> who did not use <%= tech_name %> </p > 
                                        <p > # of <%= users %>: <%= n_comparison %> </p > 
                                    </div > 
                            
                                    <div class="col-xs-4 white-background-blue-border" > 
                                        <strong > Evaluation Context</strong > <br / > 
                                        <em > School Type</em > : [Public]<br / > 
                                        <em > District Size</em > : [1200]<br / > 
                                        <em > Setting</em > : [Suburban]<br / >
                                        <em > Location</em > : [Midwest]<br / > 
                                        <strong > Overall Student Population</strong > <br / > 
                                        <em > Non-white</em > : [XX%]<br / > 
                                        <em > Hispanic</em > : [XX%]<br / > 
                                        <em > Female</em > : [XX%]<br / > 
                                        <em > Free or Reduced Price Lunch</em > : [XX%]<br / > 
                                        <em > English Learners</em > : [XX%]<br / > 
                                        <em > Students with IEPs</em > : [XX%]<br / >
                                    </div > 
                                </div > 
                        
                                <p > Table 1 below summarizes key characteristics of the study sample: </p > 
                                <p > <strong > Table 1. Background Characteristics of the Evaluation Sample</strong > </p > 
                                <table id="table1"> 
                                    <thead > 
                                        <tr > 
                                            <% if (baseline_by_grade) { %>
                                                <th>Grade</th>
                                            <% } %>
                                            <th > Characteristic</th > 
                                            <th > Overall</th > 
                                            <th > Treatment</th > 
                                            <th > Comparison</th > 
                                            <th > Difference</th > 
                                        </tr > 
                                    </thead > 
                                    <tbody>

                                        <% for (grade in baseline_results_by_grade) {
                                            var baseline_var_means = baseline_results_by_grade[grade].match_var_means;

                                            for (characteristic in baseline_var_means) { %>
                                            <tr>
                                                <% if (baseline_by_grade) { %>
                                                <td> <%= grade %></td>
                                                <% } %>
                                                <td> <%= characteristic %></td>
                                                <td> <%= baseline_var_means[characteristic].overall[0] %></td>
                                                <td> <%= baseline_var_means[characteristic].intervention[0] %></td>
                                                <td> <%= baseline_var_means[characteristic].comparison[0] %></td>
                                                <td> <%= baseline_var_means[characteristic].difference[0] %></td>
                                            </tr>
                                        <% }} %>
                                    </tbody> 
                                    <tfoot>
                                        <tr>
                                            <% if (baseline_by_grade) { %>
                                                <td></td>
                                            <% } %>
                                            <td> Number of <%= users %></td>
                                            <td> <%= n_overall %></td>
                                            <td> <%= n_treatment %></td>
                                            <td> <%= n_comparison %></td>
                                            <td> --</td>
                                        </tr>
                                    </tfoot>
                                    
                                </table > 
                            </div > 
                        </div > 
                        
                        <div class="row" > 
                            <div class="col-xs-1 circle" > 
                            </div > 
                        
                            <div class="col-xs-11" > 
                                <h2 > The evaluation period lasted <%= eval.planContext.Plan_Context_A_4 %>.</h2 > 
                                <p > During this period, <%= users %> in the intervention group were intended to use the technology <%= eval.planContext.Plan_Context_A_3 %>. [Students in the comparison group did not have access to ReadTech.] </p > 
                                <p > <strong > Challenges/Limitations:</strong > <%= eval.planContext.Plan_Context_C %>. <%= eval.planContext.Plan_Context_D %> </p > 
                                <p > [Other contextual factors or supports being provided to students may have contributed to results.] [Other factors include: [open response from summarize context]] </p > 
                            </div > 
                        </div > 
                        
                        <div class="row" > 
                            <div class="col-xs-1 circle" > 
                            </div > 
                        
                            <div class="col-xs-11" > 
                                <h2 > Academic achievement was measured using the benchmark reading assessment.</h2 > 
                                <p > Analysis of <%= tech_name %> controls for: <span class="baseline_vars_wordlist"><%= baseline_vars_wordlist %>.</span>
                                    <% if (analysis_by_grade) { %>
                                        Analysis was also conducted by grade.
                                    <% } %> </p > 
                            </div > 
                        </div > 

                        <div class="row" > 
                            <div class="col-xs-1 circle" > 
                            </div > 

                            <div class="col-xs-11" > 
                                <h2 > Conclusions and Next Steps</h2 > 
                                <p > [Based on the results I will expand use of <%= tech_name %> to all 4th grade students and will look into piloting the technology in other grades. I will set up the pilots in a manner that allows me to conduct similar evaluations.] 
                                </p > 
                            </div > 
                        </div >
                    </div>
                </div>
            </div>
        </div>
                
        <% include ../views/partials/toolButtons.html %>
    </form > 
    
    <% include ../views/partials/footer.html %>
    <script src='/static/js/custom.js' ></script > 
    <script>
        
        $(document).ready(function () {
            $('#brief-results').on('click', 'span.editable', function () {
                var width = $(this).width();
                var reset = $(this).text();
                var str = '<form class="edit-form" style="display: inline;">' + '<input type="text" class="editing" data-reset="' + reset + '" style="width: ' + (width * 2) + 'px;" value="' + $(this).text() + '"></form>';
                $(this).replaceWith(str);
            })
            .on('keydown', 'input.editing', function() {
                var width = $(this).width();
                var minWidth = 9 * $(this).val().length
                if (width < minWidth) {
                    $(this).width(minWidth);
                }
            })
            .on('blur', 'input.editing', function () {
                var val = $(this).val();
                
                if (val === '') {
                    val = $(this).attr('data-reset');
                }
                
                $(this).parent('form.edit-form').replaceWith('<span class="editable">' + val + '</span>');
            })
            .on('submit', 'form.edit-form', function (e) {
                e.preventDefault();
                var edit = $(this).children('input.editing');
                var val = $(edit).val();

                if (val === '') {
                    val = $(edit).attr('data-reset');
                }

                $(this).replaceWith('<span class="editable">' + val + '</span>');
            });

            $("#relabel-baseline-vars").click(function (e) {
                // Prevent form submission
                e.preventDefault();

                var newLabels = [];

                // Get value of all relabel inputs. For any blanks, revert to previous value.
                $('.relabel-baseline-var').each( function() {
                    var val = $(this).val();

                    if (val === '') {
                        val = $(this).attr('data-reset');
                        $(this).val(val);
                    }
                    else {
                        $(this).attr('data-reset', val);
                    }
                    newLabels.push(val);
                });

                // Function to convert array into word list (e.g. ["word1", "word2", "word3"] -> "word1, word2, and word3")
                var wordList = function (x) {
                    var out;

                    if (x.length === 1) {
                        out = x;
                    }
                    else if (x.length === 2) {
                        out = x[0] + ' and ' + x[1];
                    }
                    else {
                        out = x.slice(0, x.length - 1).join(', ') + ', and ' + x.slice(-1);
                    }

                    return out;
                }

                // Replace baseline var wordlists with new labels.
                $("span.baseline_vars_wordlist").text(wordList(newLabels));
            });

        });
    </script>
    </body > 
</html >
            